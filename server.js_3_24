"use strict";

const { Client } = require('pg');
const express = require('express');
const app = express();
app.use(express.static("public"));
const PORT = 8000;
app.listen(PORT);

const clientConfig = {
  user: 'postgres', 
password: 'mypacepostgresql', 
host: 'my-pace-postgresql.cnka62k42bab.us-east-2.rds.amazonaws.com', 
port: 5432, 
ssl: { 
rejectUnauthorized: false, 
} 
};

app.get('/country', async function (req, res) {
const code = req.query['code']; 
const client = new Client(clientConfig); 
  await client.connect(); 
  const result = await client.query("SELECT NAME FROM country WHERE CODE=$1::text", [code]); 
  if (result.rowCount < 1) { 
  res.status(500).send("Internal Error - No Country Found"); 
  } else { 
  res.set("Content-Type", "application/json"); 
  res.send(result.rows[0]); 
 }  
 await client.end(); 
});

app.get('/states', async function (req, res) {
const country = req.query['country'];
const client = new Client(clientConfig); 
await client.connect(); 
const result1 = await client.query("SELECT state_name, state_code FROM states_by_country WHERE country_code = $1::text", [country]);
if (result1.rowCount < 1) { 
res.status(500).send("Internal Error - No Country Found"); 
} else { 
res.set("Content-Type", "application/json"); 
res.send(result1.rows); 
} 
await client.end(); 
});
